resources:
  pipelines:
    retail_dlt_pipeline:
      name: "[${bundle.target}] Retail E-commerce DLT Pipeline"

      # Target catalog and schema for output tables
      catalog: ${var.catalog_name}
      target: ${var.target_schema}

      # Pipeline configuration - dynamic based on environment
      development: ${{ bundle.target == "dev" }}
      continuous: false
      photon: true
      serverless: true

      # Edition configuration
      edition: ADVANCED

      # Channel for pipeline runtime
      channel: CURRENT

      # Libraries - DLT pipeline notebook
      libraries:
        - notebook:
            path: ../src/pipelines/retail_dlt_pipeline.py

      # Pipeline configuration
      configuration:
        pipeline.description: "Delta Live Tables pipeline for retail e-commerce data processing with dbldatagen synthetic data"
        pipeline.owner: ${workspace.current_user.userName}
        bundle.sourcePath: ${workspace.file_path}
        bundle.target: ${bundle.target}

      # Notifications
      notifications:
        - alerts:
            - on-update-failure
            - on-update-fatal-failure
            - on-flow-failure
          email_recipients:
            - ${workspace.current_user.userName}

      # Permissions - more granular access control
      permissions:
        - level: CAN_VIEW
          group_name: users
        - level: CAN_RUN
          user_name: ${workspace.current_user.userName}
